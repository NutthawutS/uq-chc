<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Campaign Health Check (CHC)</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 24px;
  }
  h2 { margin-bottom: 8px; }
  .box {
    border: 1px dashed #ccc;
    padding: 16px;
    margin-bottom: 16px;
  }
  .cards {
    display: flex;
    gap: 16px;
    margin: 16px 0;
  }
  .card {
    flex: 1;
    border: 1px solid #ddd;
    padding: 12px;
    text-align: center;
  }
  .green { color: green; }
  .yellow { color: orange; }
  .red { color: red; }
  button {
    padding: 8px 14px;
    cursor: pointer;
  }
</style>
</head>

<body>

<h2>Campaign Health Check (CHC)</h2>
<p>Upload Excel → Select week → Analyze</p>

<div class="box">
  <input type="file" id="fileInput" />
</div>

<div class="box">
  <label>Week:</label>
  <select id="week">
    <option value="W1">Week 1</option>
    <option value="W2">Week 2</option>
    <option value="W3">Week 3</option>
    <option value="W4">Week 4</option>
    <option value="W5">Week 5</option>
  </select>

  <label style="margin-left:12px;">
    <input type="checkbox" id="saveLog" checked />
    Save log
  </label>

  <button onclick="runCHC()">Run Health Check</button>
</div>

<hr />

<div id="dashboard"></div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbykoWBT9gtu5Bd4OMkAipItOaXRCWxyhtmK2HS743Xs5p4Gx9TZIYqpyqAdkrm8ggOO/exec";

function runCHC() {
  const file = document.getElementById('fileInput').files[0];
  const week = document.getElementById('week').value;
  const save = document.getElementById('saveLog').checked;

  if (!file) {
    alert('Please upload Excel file');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify({
        file: e.target.result,
        filename: file.name,
        week,
        save
      })
    })
    .then(res => res.json())
    .then(renderDashboard)
    .catch(err => alert('Error: ' + err));
  };

  reader.readAsDataURL(file);
}

function renderDashboard(data) {
  document.getElementById('dashboard').innerHTML = `
    <h3>Overview (Week ${data.meta.week})</h3>

    <div class="cards">
      <div class="card">
        <strong>${data.meta.campaigns}</strong><br/>
        Campaigns
      </div>
      <div class="card">
        <strong>${(data.meta.missingRate * 100).toFixed(1)}%</strong><br/>
        Missing Rate
      </div>
      <div class="card">
        <strong>${data.meta.riskCount}</strong><br/>
        Risk
      </div>
    </div>

    <p>
      Run at: ${new Date(data.meta.runAt).toLocaleString()}
    </p>
  `;
}
</script>

</body>
</html>
